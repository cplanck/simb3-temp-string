// Basic I2C slave code for testing iterative communication to master
// written 4 December, 2022 by Cameron Planck

#include <Wire.h>       
#include <OneWire.h>
#include <DallasTemperature.h>

int state = 0;

void setup(){
  Serial.begin(9600);

  // initialize I2C with address 1
  Wire.begin(1);   

  // runs when master sends data                            
  Wire.onReceive(receiveEvent);

  // runs when master asks for data
  Wire.onRequest(requestEvent);
  
}

// called when master sends data
void receiveEvent(int numBytes){
  while(Wire.available()){
    Serial.println("DATA FROM MASTER RECEIVED");
    state = Wire.read(); // update state with whatever master sent
    Serial.print(state); // maybe this is the problem? Calling a serial command inside an i2c method
  }
}

// called when master asks for data
void requestEvent(){
  Serial.println("SENDING DATA TO MASTER");
  if(state == 1){
      byte array[80] = {0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA, 0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA, 0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA,0xF, 0xA};
      Wire.write(array, 80);  
    }
  }

 void loop(){}
